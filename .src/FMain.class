' Gambas class file

Private $Schaden As FSchaden
Private $s As Settings

Public Sub SpinBox1_Change()
  
  Dim i As Integer
  
  i = SpinBox1.Value
  i += ValueBox1.Value
  If CheckBox1.Value Then
    i += 3
  Endif
  If CheckBox2.Value Then
    i += 1
  Endif
  If CheckBox3.Value Then 
    i += 10
  Endif
  
  Label1.Text = "Angriff ist: " & i
  
  Select SpinBox1.Value
    Case 20
      LCDLabel1.Foreground = Color.Green
      LCDLabel1.Text = "Critical CRIT"
      $Schaden.setcrit()
      
    Case 1
      LCDLabel1.Foreground = Color.Red
      LCDLabel1.Text = "FAIL"
    Case Else
      If SpinBox1.Value >= ValueBox2.Value Then
        LCDLabel1.Foreground = Color.Green
        LCDLabel1.Text = "Crit"
        $Schaden.setcrit()
      Else 
        LCDLabel1.Text = ""
        $Schaden.unsetcrit()
      Endif
      
  End Select
  
End

Public Sub CheckBox4_Click()
  
  If CheckBox4.Value Then
    ValueBox1.Enabled = False
  Else 
    ValueBox1.Enabled = True
  Endif
  
End

Public Sub Form_Open()
  
  $Schaden = New FSchaden
  $Schaden.Show()
  $Schaden.X = Me.X - $Schaden.W
  $Schaden.Y = Me.Y
  
  $s = New Settings(Null, "OnePicePnP Angriff Calc")
  
  ValueBox1.Value = $s["Ang/Wert", 0]
  ValueBox2.Value = $s["Ang/Critrange", 20]
  $Schaden.setWisCrit($s["Schaden/WisMod", 0], $s["Schaden/CritMod", 1])
  
End

Public Sub Button1_Click()
  
  SpinBox1_Change()
  
End

Public Sub Form_Close()
  
  Dim i As Integer[]
  
  i = $Schaden.getWisCrit()
  $s["Ang/Wert"] = ValueBox1.Value
  $s["Ang/Critrange"] = ValueBox2.Value
  
  $s["Schaden/WisMod"] = i[0]
  $s["Schaden/CritMod"] = i[1]
  
  If Not $Schaden.isClose() Then $Schaden.Close
  
End
